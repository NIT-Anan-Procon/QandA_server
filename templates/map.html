<html>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" />
        <style>
            html { width: 100%; height: 100%; }
            body { width: 100%; height: 100%; margin: 0; }
            #map { width: 70%; height: 60%; }
            .leaflet-marker-icon-color-blue   { -webkit-filter: hue-rotate( 30deg); filter: hue-rotate( 30deg); }
            .leaflet-marker-icon-color-pink   { -webkit-filter: hue-rotate( 90deg); filter: hue-rotate( 90deg); }
            .leaflet-marker-icon-color-red    { -webkit-filter: hue-rotate(150deg); filter: hue-rotate(150deg); }
            .leaflet-marker-icon-color-yellow { -webkit-filter: hue-rotate(210deg); filter: hue-rotate(210deg); }
            .leaflet-marker-icon-color-green  { -webkit-filter: hue-rotate(270deg); filter: hue-rotate(270deg); }
            .leaflet-marker-icon-color-alua   { -webkit-filter: hue-rotate(330deg); filter: hue-rotate(330deg); }

            table.example{
                width:920px;
                margin-left: 20;
                border:1px #c0c0c0 solid;
                border-collapse: collapse;
                front-size:80%;
            }
            table.example caption{
            padding-bottom: 5px;
            }

            table.example th,
            table.example td{
                padding: 6px 8px;
                border: 1px #c0c0c0 solid;
            }

            table.example colgroup.item{
                background-color: #fffce7;
            }
            table.example colgroup.data{
                background-color: #ffffff;
            }
            table.example thead th{
                background-color: #deefff;
            }
        </style>
    </head>

    <body>
        <div id="map"></div>
        <button id="buttonBackToCenter">back to center</button>

        <table class="example">

            <colgroup class="item"></colgroup>
            <colgroup span="4" class="data"></colgroup>

            <tbody>
                <tr>
                    <td>ID</th>
                    <td id="table_id"></th>
                </tr>
                <tr>
                    <td>緯度経度</th>
                    <td id="table_latlng"></th>
                </tr>
                <tr>
                    <td>状態</td>
                    <td id="table_state"></td>
                </tr>
                <tr>
                    <td>問診記録</td>
                    <td id="table_records" style="word-wrap:break-word;">
                        <ul id="table_records_list" style="list-style:none;" />
                    </td>
                </tr>
                <tr>
                    <td>応急手当</td>
                    <td id="table_cares">
                        <ul id="table_cares_list" style="list-style:none;" />
                    </td>
                </td>
            </tbody>
        </table>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <script type="text/javascript" src="static/map_socket.js"></script>
        <script type="text/javascript" src="static/map_marker.js"></script>
        <script type="text/javascript">

            var mapCenterLatLng = ['{{ latlng[0] }}', '{{ latlng[1] }}'];


            //地図タイルの設定
            var map = L.map('map')
            .setView(
                mapCenterLatLng,
                13
            );

            L.tileLayer(
                'https://a.tile.openstreetmap.org/{z}/{x}/{y}.png', 
                { attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors' }
            ).addTo(map);

            //Marker of the Fire Station
            var marker = L.marker(
                mapCenterLatLng,
                { title: "marker-title" }
            )
            .addTo(map)
            .on("click", function(){
                alert('現在地：消防署');
            });
            L.DomUtil.addClass( marker._icon, 'leaflet-marker-icon-color-pink' );

            function backToCenter(){
                map.panTo(mapCenterLatLng);
            }

     
            var table = document.createElement( 'table' );

            document.querySelector('#buttonBackToCenter').onclick=function(){ backToCenter() };
            
            // add marker when it opens
            {% for marker in markers %}
                add_marker({{ marker.patient_id }}, {{ marker.state }}, '{{ marker.latlng }}', '{{ marker.interview_records }}', '{{ marker.cares }}', false)
            {% endfor %}
            
        </script>
    </body>
</html>